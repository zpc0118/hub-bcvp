from tokenizers import Tokenizer
from tokenizers.models import BPE
from tokenizers.trainers import BpeTrainer
from tokenizers.pre_tokenizers import Whitespace
import json
import time

#语料
corpus = [
    "人工智能正在以前所未有的速度改变世界。从医疗诊断到教育辅导，从交通管理到金融服务，它正在渗透到社会的每一个角落。",
    "在医院里，AI辅助系统能快速分析医学影像，帮助医生发现早期癌症迹象。这种技术不仅提高了诊断准确率，还大大缩短了等待时间。",
    "在线教育平台利用个性化推荐算法，为每个学生量身定制学习路径。无论你是小学生还是大学生，都能找到适合自己的课程。",
    "自动驾驶汽车通过激光雷达和深度神经网络感知周围环境，实现自动变道、泊车和避障功能。特斯拉、百度阿波罗等公司已在多地开展测试。",
    "语音助手如 Siri、小爱同学已能理解复杂指令，完成订餐、导航、播放音乐等任务。它们背后的自然语言处理技术不断进步。",
    "内容生成方面，AI可以撰写新闻稿、创作诗歌、甚至编写代码。OpenAI 的 GPT 系列模型展示了强大的语言创造力。",
    "然而，技术发展也带来挑战。数据隐私泄露、算法偏见、虚假信息传播等问题日益突出。我们需要建立更完善的伦理规范与监管机制。",
    "与此同时，就业结构正在发生变化。一些重复性工作被自动化取代，但同时也催生了新的职业岗位，如 AI 训练师、数据标注员、提示工程师。",
    "终身学习成为必然趋势。人们需要不断更新知识体系，掌握新技能以适应快速变化的社会。",
    "政府正在推动“数字中国”建设，加快5G、物联网、云计算基础设施布局。智慧城市项目让城市管理更高效、更智能。",
    "例如，杭州的“城市大脑”系统整合交通信号灯、公交调度、停车资源等数据，实现动态优化，显著缓解拥堵。",
    "在农业领域，无人机喷洒农药、智能温室控制温湿度、区块链溯源农产品信息，正在提升农业生产效率。",
    "环保方面，智能垃圾分类机器人能识别垃圾类型并自动分拣；碳足迹追踪系统帮助企业实现绿色转型。",
    "金融行业广泛使用 AI 进行风险评估、反欺诈检测和投资决策。高频交易算法能在毫秒级完成买卖操作。",
    "金融科技（FinTech）的发展让普通人也能便捷地进行理财、贷款和支付。移动支付普及率已超过90%。",
    "社交媒体上，短视频平台日均播放量达千亿次。用户通过视频记录生活、分享观点、表达创意。",
    "但信息过载、沉迷成瘾、网络暴力等问题也困扰着年轻一代。加强媒介素养教育刻不容缓。",
    "心理健康越来越受重视。心理咨询热线、心理测评小程序、情绪陪伴机器人开始进入大众视野。",
    "远程办公成为新常态。企业采用 Zoom、钉钉、飞书等协作工具，打破地理限制，提高团队效率。",
    "灵活用工、自由职业者数量持续增长。零工经济正在重塑传统雇佣关系。",
    "尽管如此，人与人之间的真实连接依然重要。家庭聚会、朋友聊天、社区活动不应被数字化取代。",
    "我们要在拥抱科技的同时，守护人文精神，避免陷入“数字孤独”。",
    "未来，人机协同将成为主流模式。人类负责创造性、情感性和价值判断的工作，而机器承担计算、记忆和重复性任务。",
    "这不仅是技术的进步，更是文明的演进。让我们以理性、开放和负责任的态度，共同迎接智能时代的到来。",

    "随着全球气候变化加剧，极端天气事件频发。热浪、干旱、洪水、台风对人类生存构成严重威胁。",
    "联合国气候报告指出，若不采取紧急行动，本世纪末全球气温可能上升超过2摄氏度，导致海平面上升、冰川融化、生态系统崩溃。",
    "应对气候变化已成为全人类共同责任。各国纷纷提出碳中和目标，中国承诺2030年前实现碳达峰，2060年前实现碳中和。",
    "新能源技术如太阳能、风能、氢能正在快速发展。光伏电站遍布沙漠与屋顶，海上风电场在近海绵延数公里。",
    "储能技术突破使得间歇性能源更加稳定。电动汽车销量连续多年翻倍增长，充电桩网络覆盖全国主要城市。",
    "绿色建筑采用节能材料与智能控制系统，降低能耗。低碳出行成为新风尚。骑行、步行、公共交通优先被倡导。",
    "共享出行模式减少车辆空驶率。城市绿化覆盖率持续提升，公园绿地面积不断扩大。生物多样性保护受到重视，国家公园体制逐步建立。",
    "珍稀物种如大熊猫、雪豹、中华白海豚得到更好保护。生态修复工程在退耕还林、湿地恢复、荒漠治理等方面取得显著成效。",
    "可持续发展理念深入人心。循环经济模式推广，废弃物回收利用率不断提高。垃圾分类制度在全国范围内推行，上海、北京等地实行严格分类标准。",
    "公众环保意识增强，绿色消费行为增多。购买节能家电、使用环保袋、减少一次性用品成为习惯。企业社会责任（CSR）报告成为常态。",
    "越来越多公司公开披露碳排放数据，制定减排路线图。绿色金融兴起，碳交易市场试点运行。环境影响评价制度不断完善。",
    "生态保护红线划定，禁止开发区域得到法律保障。环境监测网络覆盖全国，实时发布空气质量、水质数据。公众可通过手机应用查询环境状况，参与监督。",
    "环境公益诉讼逐渐普及，公民维权意识提升。环境教育纳入学校课程，从小培养环保理念。科学家研究气候变化归因，揭示人类活动的影响。",
    "气候模型预测未来情景，为政策制定提供依据。国际合作至关重要。《巴黎协定》是全球气候治理的重要框架。",
    "发达国家应履行资金和技术转让义务，支持发展中国家应对气候变化。南南合作加强，非洲、东南亚国家获得清洁能源援助。",
    "气候正义理念强调公平分配责任与利益。弱势群体更易受气候冲击，需特别关注。气候适应能力建设是关键。",
    "沿海城市修建防洪堤坝，内陆地区建设抗旱设施。农业适应新技术，培育耐高温、抗病虫品种。水资源管理优化，雨水收集系统普及。",
    "灾害预警系统升级，提前发布台风、暴雨、山洪警报。应急响应机制完善，救援队伍快速部署。社区韧性提升，居民掌握自救互救技能。",
    "气候教育进课堂，培训基层干部。国际组织协调资源，推动全球行动。应对气候变化不是一国之事，而是全人类命运共同体的责任。",

    "教育公平是社会进步的重要标志。然而，城乡差距、区域差异仍存在。优质教育资源集中在大城市，农村地区师资匮乏，教学设备落后。",
    "为此，国家实施“全面改薄”工程，改善薄弱学校办学条件。乡村教师支持计划提升待遇，吸引人才扎根基层。",
    "远程教育平台让偏远地区学生共享名校课程。直播课、录播课、AI助教系统覆盖数千所学校。智慧校园建设推进，电子班牌、智能阅卷、无纸化办公成为标配。",
    "学生综合素质评价体系改革，注重德智体美劳全面发展。体育课时增加，心理健康教育纳入必修。劳动教育回归，学生参与校园保洁、种植蔬菜、制作手工。",
    "职业教育地位提升，产教融合深化。校企合作开设订单班，定向培养技能人才。工匠精神得到弘扬。中职、高职毕业生就业率持续走高。",
    "高等教育毛入学率超过60%，普及化程度不断提高。双一流大学建设聚焦原始创新，提升科研能力。国家重点实验室、工程研究中心数量稳步增长。",
    "科研经费投入逐年增加，基础研究占比提高。青年科学家资助计划启动，鼓励探索未知领域。学术成果发表数量居世界前列。专利申请量连续多年世界第一。",
    "科技创新活力迸发。国家重大科技专项如“天问探火”、“嫦娥奔月”、“北斗导航”、“华龙一号”核电站成功运行。量子通信、脑机接口、可控核聚变等前沿领域取得突破。",
    "深海探测器下潜至马里亚纳海沟，发现新物种。极地科考站持续运营，获取珍贵数据。空间站“天宫”长期驻留航天员，开展科学实验。太空育种、微重力实验成果丰硕。",
    "科技自立自强成为国家战略。关键核心技术攻关“卡脖子”问题逐步破解。国产芯片、操作系统、工业软件加速替代。信创产业生态初步形成。",
    "自主可控水平显著提升。科技成果转化机制优化，高校院所与企业对接更加紧密。技术转移中心、孵化器、加速器遍布各地。创业氛围浓厚，创新型企业大量涌现。",
    "科创板、创业板为科技企业提供融资渠道。风险投资活跃，天使轮、A轮、B轮融资频繁。科技园区集聚效应明显，中关村、张江、深圳南山等成为创新高地。",
    "科技伦理委员会成立，规范科研行为。科研诚信建设加强，杜绝造假、剽窃。学术不端行为受到严肃查处。科研人员获得感增强，激励机制完善。",
    "薪酬待遇提高，职称评审更公平。国际交流合作深入。中外联合实验室、科学家互访常态化。国际会议频繁举办，中国学者积极参与。",
    "海外高层次人才回流趋势明显。科技外交发挥重要作用。科技合作成为国家间友好交流的桥梁。科技传播能力提升。科普活动走进社区、校园、农村。",
    "科学讲座、展览、短视频广受欢迎。公众科学素养不断提高。全民科学素质调查结果显示，具备基本科学素养的人口比例超过10%。科学精神深入人心。",
    "求真务实、批判思维、开放包容成为共识。科学与人文交融，推动社会文明进步。",

    "健康是幸福生活的基础。近年来，我国居民人均预期寿命持续提高，已达78.2岁。慢性病防控形势严峻，高血压、糖尿病、心脑血管疾病患病率居高不下。",
    "肥胖率上升，青少年近视率超过50%。为此，国家推出“健康中国2030”规划纲要，全面推进健康促进。全民健身运动普及，广场舞、跑步、骑行热潮涌动。",
    "公共体育设施增加，社区健身器材覆盖率达95%以上。体育赛事蓬勃发展，马拉松、篮球赛、电竞比赛吸引大量参与者。体医融合试点推进，将运动干预纳入慢病管理。",
    "康复医学受重视，术后康复、老年康复服务拓展。中医药传承创新发展。中医诊所遍地开花，针灸、推拿、中药方剂广泛应用。",
    "国家中医药管理局推动经典名方研发，古籍文献数字化。中西医结合治疗肿瘤、神经系统疾病效果显著。健康管理服务兴起。体检机构、健康管理中心、私人医生工作室快速增长。",
    "可穿戴设备如智能手环、手表普及，实时监测心率、血氧、睡眠。远程健康咨询平台开通，患者足不出户即可获得专家建议。",
    "家庭医生签约服务覆盖城乡，提供个性化健康管理方案。疫苗接种率保持高位，传染病防控有力。艾滋病、结核病等重大传染病得到有效控制。",
    "突发公共卫生事件应急能力提升。新冠疫情后，疾控体系改革加强，监测预警系统升级。核酸检测能力、隔离床位储备、药物储备充足。",
    "应急物资调配机制高效。公众防护意识增强，戴口罩、勤洗手、保持社交距离成为习惯。心理健康服务体系建设加快。全国设有心理援助热线，覆盖所有省份。",
    "心理危机干预团队组建，应对突发事件。学校设立心理咨询室，配备专业教师。职场压力疏导机制建立。抑郁症、焦虑症识别率提高，治疗率上升。",
    "精神卫生法实施，保障患者权益。精神障碍患者康复服务改善，社区康复中心增多。精神卫生服务可及性增强。全社会对心理健康的关注度前所未有。",
    "心理科普文章、纪录片、访谈节目广泛传播。消除歧视，倡导关爱。心理自助工具上线，如冥想音频、情绪日记。心理健康不再是“羞于启齿”的话题，而是全民关注的议题。",
    "医疗体制改革持续推进。分级诊疗制度落实，引导患者首诊在基层。医联体、医共体建设扩大，优质医疗资源下沉。医保报销范围扩大，药品集采降价显著。",
    "抗癌药、罕见病用药纳入医保。异地就医结算便利，跨省门诊费用直接结算。互联网医院兴起，线上复诊、购药、处方流转。智慧医院建设加速，电子病历、智能导诊、机器人送药普及。",
    "医疗数据互联互通，打破“信息孤岛”。医疗大数据分析用于疾病预测、资源调配。人工智能辅助诊断系统辅助医生决策。手术机器人精准操作，减少创伤。",
    "器官移植技术进步，成功率提高。罕见病登记系统建立，患者获益。医疗服务质量提升，患者满意度提高。医患关系逐步改善。信任重建之路漫长，但方向明确。",
    "医疗人文关怀加强，尊重患者权利，倾听患者诉求。医护人员职业荣誉感增强。医疗行业正迈向高质量发展。",

    "数字经济蓬勃发展。2023年，中国数字经济规模达56.1万亿元，占GDP比重超过40%。数字产业化与产业数字化双轮驱动。",
    "数字基础设施不断完善。5G基站总数超300万个，覆盖所有地级市和县城。千兆光网入户率超过30%。数据中心集群建设提速，算力总规模位居世界第二。",
    "云计算平台提供弹性计算资源，支撑各类应用。物联网设备连接数突破30亿，万物互联成为现实。工业互联网平台赋能制造业，实现设备联网、生产监控、智能排产。",
    "智能制造工厂广泛应用机器人、视觉识别、数字孪生。供应链数字化转型加速，库存周转率提升。零售业全面电商化。淘宝、京东、拼多多占据主导。",
    "直播带货成为新消费模式。头部主播单场销售额破亿。跨境电商出口额持续增长。数字人民币试点范围扩大，已在多个城市推广。",
    "支付方式多元化，扫码支付、刷脸支付、声纹支付普及。数字身份认证系统建设推进，身份证、社保卡、医保卡“一码通”。政务服务平台集成办事事项，实现“一网通办”。",
    "电子营业执照、电子发票、电子合同广泛应用。数字政务效能提升。营商环境优化。中小企业注册、变更、注销全程线上办理。",
    "税收征管数字化，自动申报、自动比对。市场监管数字化，信用信息公示系统健全。知识产权保护强化，数字版权管理平台上线。",
    "数据要素市场化配置改革启动。数据确权、定价、交易规则探索。数据交易所陆续成立，如北京、上海、广州、深圳。数据流通安全机制建立。",
    "数据脱敏、加密、访问控制技术应用。数据安全法、个人信息保护法出台，规范数据使用。数据滥用、泄露事件减少。数据资产入表试点推进，企业可将数据作为无形资产核算。",
    "数据价值释放，推动经济增长。数字经济成为新动能。数字产业增加值增速高于GDP增速。数字经济带动就业，新增岗位包括数据分析师、算法工程师、网络安全师、数字营销师。",
    "数字技能培训普及，提升劳动者数字素养。数字鸿沟问题仍存。老年人、低收入群体、农村地区面临“数字困境”。适老化改造加速，手机界面简化，语音助手辅助。",
    "数字反哺成为新趋势。子女教父母使用微信、支付宝、健康码。家庭内部数字协作增强。社交边界模糊。工作群、同学群、兴趣群混杂，难以区分。私密空间被压缩。",
    "信息过载导致焦虑。每天收到数百条消息，难以处理。注意力分散，专注力下降。数字断连（Digital Detox）概念流行。人们尝试定期关闭通知、远离屏幕。",
    "心理健康问题与数字生活密切相关。过度使用社交媒体与抑郁、焦虑、自卑感相关。自我价值感建立在点赞数、评论数上。比较心理加剧。社交媒体展示的是“精心策划的生活”，而非真实状态。",
    "真实生活被美化，造成心理落差。元宇宙概念兴起。虚拟世界被视为未来社交空间。头戴式设备、手势识别、脑机接口技术发展。虚拟形象、虚拟聚会、虚拟恋爱出现。",
    "但沉浸式体验也带来现实脱离风险。数字孤独感加剧。即使身处人群，也可能感到孤立。社交频率提高，但质量下降。面对面交流减少。人际信任下降。",
    "网络诈骗、虚假身份、情感欺骗层出不穷。警惕心增强。但另一方面，线上社群也带来归属感。兴趣小组、同好圈子、互助组织在线聚集。跨地域、跨文化连接成为可能。",
    "全球志愿者网络、公益众筹平台活跃。数字丝绸之路建设推进，助力发展中国家数字基建。数字合作成为国际合作新领域。数字文明是人类文明的新形态，正在塑造未来社会。",

    "社会交往方式深刻变革。社交媒体成为人们获取信息、表达观点、建立联系的主要渠道。微信、微博、抖音、小红书、快手等平台日活用户合计超10亿。",
    "朋友圈、微博热搜、抖音热门成为社会热点风向标。信息传播速度空前。一条消息可在几分钟内传遍全国。舆论场多元，意见碰撞激烈。",
    "网络空间不再是“沉默的大多数”，每个人都有发声机会。但也出现“信息茧房”、“回音室效应”、“群体极化”现象。算法推荐加剧认知偏差。",
    "用户只看到自己感兴趣的内容，形成封闭的信息圈层。不同群体间沟通困难，误解加深。网络暴力、人肉搜索、网络欺凌频发。受害者心理创伤严重。",
    "平台加强内容审核，建立举报机制。法律介入，刑法修正案增设侮辱罪、诽谤罪适用网络场景。人格权保护力度加大。",
    "虚拟财产纠纷增多。网络游戏账号、皮肤、装备被盗或被非法交易。法院判决确认虚拟财产具有财产权属性。数字遗产继承问题浮现。",
    "去世者的社交账号、数字文件如何处置？法律尚未明确。数字身份安全受威胁。账号被盗、密码泄露事件屡见不鲜。双重验证、生物识别成为标配。",
    "数字信任体系构建中。区块链技术用于身份认证、电子签名、合同存证。数字可信身份逐步普及。社交关系也在重构。线上好友数量远超线下，但深度连接减少。",
    "亲情、友情维系更多依赖文字、语音、视频。家庭群聊、亲子互动视频成为常态。代际沟通出现“数字鸿沟”。父母不懂智能手机，孩子无法有效沟通。",
    "数字反哺成为新趋势。子女教父母使用微信、支付宝、健康码。家庭内部数字协作增强。社交边界模糊。工作群、同学群、兴趣群混杂，难以区分。私密空间被压缩。",
    "信息过载导致焦虑。每天收到数百条消息，难以处理。注意力分散，专注力下降。数字断连（Digital Detox）概念流行。人们尝试定期关闭通知、远离屏幕。",
    "心理健康问题与数字生活密切相关。过度使用社交媒体与抑郁、焦虑、自卑感相关。自我价值感建立在点赞数、评论数上。比较心理加剧。",
    "社交媒体展示的是“精心策划的生活”，而非真实状态。真实生活被美化，造成心理落差。元宇宙概念兴起。虚拟世界被视为未来社交空间。",
    "头戴式设备、手势识别、脑机接口技术发展。虚拟形象、虚拟聚会、虚拟恋爱出现。但沉浸式体验也带来现实脱离风险。数字孤独感加剧。",
    "即使身处人群，也可能感到孤立。社交频率提高，但质量下降。面对面交流减少。人际信任下降。网络诈骗、虚假身份、情感欺骗层出不穷。",
    "警惕心增强。但另一方面，线上社群也带来归属感。兴趣小组、同好圈子、互助组织在线聚集。跨地域、跨文化连接成为可能。全球志愿者网络、公益众筹平台活跃。",
    "数字丝绸之路建设推进，助力发展中国家数字基建。数字合作成为国际合作新领域。数字文明是人类文明的新形态，正在塑造未来社会。",

    "未来展望：科技将继续引领社会发展。人工智能将更加通用，具备更强推理与创造力。通用人工智能（AGI）虽遥远，但阶段性突破不断。",
    "人机协作模式成熟，分工明确。人类专注于价值判断、艺术创造、情感交流；机器处理数据、执行任务。教育将彻底变革。个性化学习系统根据学生认知风格、兴趣爱好、学习进度动态调整内容。",
    "虚拟教师、智能导师普及。终身学习成为生活方式。学习不再局限于学校，而是贯穿一生。工作形式更加灵活。远程办公、混合办公常态化。",
    "自由职业、项目制工作盛行。职业边界模糊，跨界人才吃香。社会流动性增强。技能证书、作品集成为求职核心。学历不再是唯一通行证。",
    "社会保障体系将适应新就业形态。灵活就业人员参保机制完善。失业保险、工伤保险覆盖范围扩大。养老制度创新，个人养老金账户普及。",
    "社会治理智能化。城市治理由“经验型”转向“数据驱动型”。公共资源配置更科学。应急响应更迅速。公共服务更精准。但技术不能解决一切问题。",
    "人性、伦理、公平、正义仍是根本。我们不能让技术决定我们的价值取向。在追求效率的同时，不忘温度与关怀。在享受便利的同时，警惕失控与异化。",
    "技术是工具，人是目的。我们应以科技向善为宗旨，构建一个更美好、更包容、更可持续的未来。",

    "让我们携手前行，以理性之光驱散迷雾，以人文之爱温暖世界，共同书写属于这个时代的精彩篇章。"
]

#  创建 tokenizer ==================
tokenizer = Tokenizer(BPE(unk_token="[UNK]"))
tokenizer.pre_tokenizer = Whitespace()

#  配置 trainer
trainer = BpeTrainer(
    vocab_size=5000,
    min_frequency=1,
    special_tokens=["[UNK]", "[CLS]", "[SEP]", "[PAD]"],
    show_progress=True,
    # continuing_subword_prefix="##"
)

# 训练基于 200000+  字语料的 BPE 模型...

tokenizer.train_from_iterator(corpus, trainer=trainer)


#  查看词表 ==================
print("\n🔍 前 50 个 token（按频率排序）：")
for i in range(50):
    print(f"{i:2d}: {tokenizer.id_to_token(i)}")

#  测试
test_sentences = [
    "人工智能正在改变世界。",
    "学习编程很有趣。",
    "区块链技术可用于食品安全溯源。",
    "使用钉钉进行远程会议非常方便。",
    "提示工程师是新兴的职业岗位。",
    "碳中和目标推动各行各业绿色转型。",
    "可穿戴设备能实时监测心率、血压和睡眠质量。"
]

for sent in test_sentences:
    encoded = tokenizer.encode(sent)
    print(f"\n📝 {sent}")
    print(f"📊 {encoded.tokens}")

#  保存
tokenizer.save("bpe_tokenizer_21k.json")
with open("bpe_vocab_21k.json", "w", encoding="utf-8") as f:
    json.dump({i: tokenizer.id_to_token(i) for i in range(tokenizer.get_vocab_size())}, f, ensure_ascii=False, indent=2)

print("\n💾 模型与词表已保存。")